<!DOCTYPE html>
<html>
<head>
    <title>Bluetooth Audio Gateway</title>
        <meta charset="UTF-8">
            <style>
                    body { font-family: Arial, sans-serif; margin: 20px; }
                            button { margin: 5px; padding: 10px; }
                                    #devices { margin-top: 20px; }
                                            .device { padding: 10px; border-bottom: 1px solid #ccc; }
                                                </style>
                                                </head>
                                                <body>
                                                    <h1>Bluetooth Audio Gateway</h1>
                                                        
                                                            <button onclick="scanDevices()">Scanner les appareils</button>
                                                                <button onclick="connectSelected()">Connecter l'appareil sélectionné</button>
                                                                    
                                                                        <div id="devices"></div>
                                                                            
                                                                                <script>
                                                                                        let selectedDevice = null;
                                                                                                
                                                                                                        async function scanDevices() {
                                                                                                                    const response = await fetch('/api/devices');
                                                                                                                                const data = await response.json();
                                                                                                                                            
                                                                                                                                                        const container = document.getElementById('devices');
                                                                                                                                                                    container.innerHTML = '<h3>Appareils trouvés:</h3>';
                                                                                                                                                                                
                                                                                                                                                                                            data.devices.forEach(device => {
                                                                                                                                                                                                            const div = document.createElement('div');
                                                                                                                                                                                                                            div.className = 'device';
                                                                                                                                                                                                                                            div.innerHTML = `
                                                                                                                                                                                                                                                                <input type="radio" name="device" value="${device.address}" 
                                                                                                                                                                                                                                                                                           onchange="selectDevice('${device.address}', '${device.name}')">
                                                                                                                                                                                                                                                                                                               <strong>${device.name}</strong> (${device.address})
                                                                                                                                                                                                                                                                                                                               `;
                                                                                                                                                                                                                                                                                                                                               container.appendChild(div);
                                                                                                                                                                                                                                                                                                                                                           });
                                                                                                                                                                                                                                                                                                                                                                   }
                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                   function selectDevice(address, name) {
                                                                                                                                                                                                                                                                                                                                                                                               selectedDevice = { address, name };
                                                                                                                                                                                                                                                                                                                                                                                                           console.log('Appareil sélectionné:', selectedDevice);
                                                                                                                                                                                                                                                                                                                                                                                                                   }
                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                   async function connectSelected() {
                                                                                                                                                                                                                                                                                                                                                                                                                                               if (!selectedDevice) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                               alert('Veuillez sélectionner un appareil');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                               return;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   const response = await fetch('/api/connect', {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   method: 'POST',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   headers: { 'Content-Type': 'application/json' },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   body: JSON.stringify({ address: selectedDevice.address })
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       const result = await response.json();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   if (result.success) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   alert(`Connecté à ${selectedDevice.name} avec succès!`);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               } else {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               alert(`Erreur: ${result.error}`);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       </script>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       </body>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       </html>